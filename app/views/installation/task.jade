extends ../layouts/defualt

block title
   title 装机任务 - #{pkg.name}

block content
   div.row.col-md-6.col-md-offset-2.custyle
      table.table.table-striped.custab
         thead
            a.btn.btn-primary.btn-xs.pull-right(href='/machine/installation/task/new')
               b +添加
            tr
               th 关联单号
               th 状态
               th 创建者
               th 开始日期
               th 结束日期
               th 地址
               th.text-center 操作
         tbody
            each installation in installations
              tr
                 td #{installation.No}
                 td #{installation.state}
                 td #{installation.creator ? installation.creator.name : ''}
                 td #{installation.task.from}
                 td #{installation.task.to}
                 td #{installation.customerAddress}
                 td.text-center.btn-toolbar(data-id=installation._id.toString())
                    a.btn.btn-info.btn-xs(href='/installation/edit/' + installation._id)
                       span.glyphicon.glyphicon-edit
                       - var state = installation.state === '未开始' ? '开始' : '提交日志'
                       | #{state}
                    a.btn.btn-danger.btn-xs
                       span.glyphicon.glyphicon-remove
                       | 删除

block foot-script
   script.
      require(['jquery'], function ($) {
         $(function () {
            $('tbody').on('click', '.btn-danger', function () {
               var $self = $(this);
               $.ajax({
                  type: 'DELETE',
                  url: '/installation/' + $self.parent().data('id')
               }).done(function () {
                  var $tr = $self.parent();
                  $tr.remove();
               }).fail(function (jqxhr) {
                  console.log(jqxhr.status);
                  console.log(jqxhr.responseJSON);
               });
            });

            $('tbody').on('click', '.btn-info', function () {
               var $self = $(this);
               if ($self.text() === '提交日志') {
                  location.href = '/installation/log/' + $self.parent().data('id');
               }
               $.ajax({
                  type: 'DELETE',
                  url: '/installation/' + $self.parent().data('id')
               }).done(function () {
                  var $tr = $self.parent();
                  $tr.remove();
               }).fail(function (jqxhr) {
                  console.log(jqxhr.status);
                  console.log(jqxhr.responseJSON);
               });
            });
         });
      });

